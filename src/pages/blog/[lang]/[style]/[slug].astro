---
import { getEntryBySlug } from "astro:content";
import PostLayout from '$/layouts/post.astro';

import Callout from "$/components/mdoc/Callout.astro";
import Link from "$/components/mdoc/Link.astro";
import TweetEmbed from "$/components/mdoc/TweetEmbed.astro";
import YTVideoEmbed from "$/components/mdoc/YTVideoEmbed.astro";
import Tabs from "$/components/mdoc/Tabs/Tabs.astro";
import { getCollection } from 'astro:content'

export async function getStaticPaths() {
  const pages = await getCollection('blog')

  const paths = pages.map(page => {
    console.log(page.slug)
    const [lang, style, ...slug] = page.slug.split('/');
    return { params: { lang, style, slug: slug.join('/') || undefined }, props: page }
  })

  return paths;
}

// get the views count
// get the likes count

const { lang, style, slug } = Astro.params;
const page = Astro.props;

const resp = await fetch(`${import.meta.env.SITE_URI}/api/blog/views/${slug}`)
const stats = await resp.json()

const { Content } = await page.render()
---
<PostLayout content={page.data} stats={stats}>
    <!-- <Content components={{
        Callout,
        Link,
        TweetEmbed,
        YTVideoEmbed,
        Tabs
    }}/> -->
    <Content />
</PostLayout>
